<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ç»™å¶å­çš„é“æ­‰</title>
  <style>
    :root{
      --bg1:#070816;
      --bg2:#1a0a2c;
      --card:#ffffff14;
      --card2:#ffffff1c;
      --txt:#fff;
      --muted:#ffffffcc;
      --yes:#4ade80;
      --no:#f87171;
      --btnTxt:#0b1020;
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "PingFang SC","Noto Sans SC", Arial, sans-serif; }
    body{
      overflow:hidden;
      background:
        radial-gradient(1200px 700px at 20% 20%, #3b82f650, transparent 60%),
        radial-gradient(900px 600px at 80% 30%, #a855f750, transparent 55%),
        radial-gradient(900px 700px at 50% 90%, #22c55e30, transparent 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      color:var(--txt);
    }

    canvas#fx{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:999;
    }

    .wrap{
      height:100%;
      display:grid;
      place-items:center;
      padding:24px;
    }
    .card{
      width:min(860px, 96vw);
      border-radius:28px;
      background: linear-gradient(180deg, var(--card), var(--card2));
      backdrop-filter: blur(10px);
      border:1px solid #ffffff22;
      box-shadow: 0 20px 90px #00000066;
      padding:34px 28px 24px;
      position:relative;
    }

    h1{
      margin:0 0 10px;
      font-size: clamp(30px, 4.2vw, 46px);
      letter-spacing: .4px;
      line-height: 1.15;
    }
    p{
      margin: 12px 0;
      color: var(--muted);
      line-height:1.7;
      font-size: clamp(16px, 2vw, 20px);
    }
    .note{
      margin-top:16px;
      padding:16px 18px;
      border-radius:18px;
      background:#ffffff12;
      border:1px dashed #ffffff33;
      color:#f1f2ff;
      font-size: clamp(15px, 1.7vw, 18px);
      line-height: 1.7;
    }

    .stage{
      position:relative;
      margin-top:22px;
      height:260px;
      border-radius:22px;
      background: #00000022;
      border:1px solid #ffffff14;
      overflow:hidden;
    }

    .btn{
      border:0;
      padding:16px 28px;
      font-weight:900;
      border-radius:999px;
      cursor:pointer;
      user-select:none;
      box-shadow: 0 12px 34px #00000055;
      transition: transform .12s ease, filter .12s ease, box-shadow .12s ease;
      position:absolute;
      min-width:150px;
      font-size: 20px;
      letter-spacing: .5px;
    }
    .btn:hover{ transform: translateY(-2px) scale(1.02); filter:brightness(1.03); }
    .btn:active{ transform: translateY(0) scale(0.99); box-shadow: 0 8px 22px #00000044; }

    #yesBtn{ background: var(--yes); color: var(--btnTxt); left: 30%; top: 58%; }
    #noBtn{ background: var(--no); color: #ffffff; left: 58%; top: 58%; }

    .toast{
      position:fixed;
      left:50%;
      top:18px;
      transform: translateX(-50%);
      background:#00000066;
      border:1px solid #ffffff22;
      backdrop-filter: blur(8px);
      color:#ffffffef;
      padding:12px 16px;
      border-radius:999px;
      font-size:14px;
      z-index:1001;
      opacity:0;
      transition: opacity .25s ease, transform .25s ease;
      pointer-events:none;
    }
    .toast.show{
      opacity:1;
      transform: translateX(-50%) translateY(4px);
    }

    .finalText{
      position:fixed;
      left:50%;
      top:50%;
      transform: translate(-50%, -50%);
      z-index:1002;
      text-align:center;
      font-weight:1000;
      font-size: clamp(26px, 4vw, 52px);
      letter-spacing: .6px;
      color:#ffffff;
      text-shadow: 0 20px 60px #000000aa;
      opacity:0;
      transition: opacity .6s ease, transform .6s ease;
      pointer-events:none;
      padding: 0 16px;
      line-height: 1.25;
    }
    .finalText.show{
      opacity:1;
      transform: translate(-50%, -52%);
    }
  </style>
</head>
<body>
  <canvas id="fx"></canvas>
  <div class="toast" id="toast">å®ƒè·‘äº†â€¦å› ä¸ºå®ƒå¿ƒè™š ğŸ˜…</div>
  <div class="finalText" id="finalText">æˆ‘å°±çŸ¥é“å°å¶å­æœ€å¥½äº†ï¼Œæ™šä¸Šè¯·ä½ åƒå¤§é¤å»å§</div>

  <div class="wrap">
    <div class="card">
      <h1>å¶å­ï¼Œæˆ‘æƒ³è®¤çœŸè·Ÿä½ è¯´å£°å¯¹ä¸èµ·ã€‚</h1>
      <p>
        æˆ‘çŸ¥é“ä½ ç°åœ¨å¾ˆå¤±æœ›ï¼Œä¹Ÿéœ€è¦æ—¶é—´æ¶ˆåŒ–ã€‚<br>
        ä½†æˆ‘ä¸æƒ³æŠŠâ€œåœ¨æ„â€å˜æˆâ€œéšç’â€ï¼Œä¸æƒ³è®©ä½ ä¸€ä¸ªäººæ‰¿å—é‚£ç§ä¸å®‰å…¨æ„Ÿã€‚<br>
        æˆ‘ä¼šç”¨è¡ŒåŠ¨æŠŠä½ è¦çš„â€œå¯é â€å’Œâ€œå¦è¯šâ€æ‹¼å¥½ã€‚
      </p>

      <div class="note">
        ä½ å¯ä»¥æ…¢æ…¢æ¶ˆåŒ–ã€‚æˆ‘ä¼šåœ¨ï¼Œä¸é€ƒé¿ï¼Œä¹Ÿä¸æ•·è¡ã€‚<br>
        åªè¦ä½ æ„¿æ„ç»™æˆ‘ä¸€æ¬¡æœºä¼šï¼Œæˆ‘ä¼šæŠŠâ€œä½ æœ€é‡è¦â€åšæˆé•¿æœŸæœ‰æ•ˆã€‚
      </div>

      <div class="stage" id="stage">
        <button class="btn" id="yesBtn">åŸè°…</button>
        <button class="btn" id="noBtn">ä¸åŸè°…</button>
      </div>
    </div>
  </div>

<script>
  // ========= 1) â€œä¸åŸè°…â€æŒ‰é’®èº²é¿ =========
  const stage = document.getElementById('stage');
  const noBtn = document.getElementById('noBtn');
  const yesBtn = document.getElementById('yesBtn');
  const toast = document.getElementById('toast');
  const finalText = document.getElementById('finalText');

  let lastMoveAt = 0;
  function showToast(){
    toast.classList.add('show');
    clearTimeout(showToast._t);
    showToast._t = setTimeout(()=> toast.classList.remove('show'), 850);
  }
  function clamp(n,min,max){ return Math.max(min, Math.min(max,n)); }

  function moveNoButton(){
    const now = performance.now();
    if (now - lastMoveAt < 120) return;
    lastMoveAt = now;

    const pad = 18;
    const st = stage.getBoundingClientRect();
    const nb = noBtn.getBoundingClientRect();
    const maxLeft = st.width - nb.width - pad;
    const maxTop  = st.height - nb.height - pad;

    const left = clamp(Math.random()*maxLeft, pad, maxLeft);
    const top  = clamp(Math.random()*maxTop,  pad, maxTop);

    noBtn.style.left = left + 'px';
    noBtn.style.top  = top + 'px';

    noBtn.animate([
      { transform: 'translateY(0) rotate(0deg) scale(1)' },
      { transform: 'translateY(-3px) rotate(-4deg) scale(1.03)' },
      { transform: 'translateY(0) rotate(3deg) scale(1)' }
    ], { duration: 220, easing: 'ease-out' });

    showToast();
  }

  ['mouseenter','mousemove','pointermove','touchstart'].forEach(evt=>{
    noBtn.addEventListener(evt, (e)=>{
      moveNoButton();
      e.preventDefault?.();
    }, { passive:false });
  });

  stage.addEventListener('mousemove', (e)=>{
    const st = stage.getBoundingClientRect();
    const x = e.clientX - st.left;
    const y = e.clientY - st.top;

    const nb = noBtn.getBoundingClientRect();
    const nx = (nb.left - st.left) + nb.width/2;
    const ny = (nb.top - st.top) + nb.height/2;

    const dist = Math.hypot(x-nx, y-ny);
    if (dist < 95) moveNoButton();
  });

  // ========= 2) ç‚¹â€œåŸè°…â€åï¼šé’¢ç´ + å¤§çˆ±å¿ƒçƒŸèŠ± =========
  const canvas = document.getElementById('fx');
  const ctx = canvas.getContext('2d');
  function resize(){
    const dpr = window.devicePixelRatio || 1;
    canvas.width = Math.floor(window.innerWidth * dpr);
    canvas.height = Math.floor(window.innerHeight * dpr);
    canvas.style.width = window.innerWidth + 'px';
    canvas.style.height = window.innerHeight + 'px';
    ctx.setTransform(dpr,0,0,dpr,0,0);
  }
  window.addEventListener('resize', resize);
  resize();

  let particles = [];
  let animOn = false;
  let phase = 'idle'; // idle -> form -> hold -> burst -> done
  let t0 = 0;

  // Heart shape points (parametric)
  function heartPoints(count, scale){
    const pts = [];
    for(let i=0;i<count;i++){
      const a = (i / count) * Math.PI * 2;
      // classic heart param
      const x = 16*Math.pow(Math.sin(a),3);
      const y = 13*Math.cos(a) - 5*Math.cos(2*a) - 2*Math.cos(3*a) - Math.cos(4*a);
      pts.push({ x: x*scale, y: -y*scale });
    }
    return pts;
  }

  function spawnHeartFirework(){
    const w = window.innerWidth, h = window.innerHeight;
    const cx = w/2, cy = h/2;

    const pts = heartPoints(520, Math.min(w,h)*0.015); // overall size
    particles = pts.map(p => {
      const jitter = 10;
      const tx = cx + p.x + (Math.random()*jitter - jitter/2);
      const ty = cy + p.y + (Math.random()*jitter - jitter/2);

      return {
        x: cx + (Math.random()*20 - 10),
        y: cy + (Math.random()*20 - 10),
        vx: 0, vy: 0,
        tx, ty,
        life: 0,
        alpha: 0,
        size: 14 + Math.random()*10,
        spin: (Math.random()*2-1)*0.08,
        rot: Math.random()*Math.PI*2,
        emoji: Math.random() < 0.55 ? 'ğŸ’—' : (Math.random() < 0.5 ? 'ğŸ’–' : 'âœ¨'),
        burstVx: 0,
        burstVy: 0,
      };
    });

    phase = 'form';
    t0 = performance.now();
    animOn = true;
    requestAnimationFrame(tick);
  }

  function drawBackgroundGlow(){
    const w = window.innerWidth, h = window.innerHeight;
    ctx.save();
    ctx.globalAlpha = 0.12;
    ctx.beginPath();
    ctx.arc(w/2, h/2, Math.min(w,h)*0.38, 0, Math.PI*2);
    ctx.fillStyle = '#ffffff';
    ctx.fill();
    ctx.restore();
  }

  function tick(now){
    if (!animOn) return;
    const w = window.innerWidth, h = window.innerHeight;
    const dt = Math.min(34, now - (tick._last || now));
    tick._last = now;

    ctx.clearRect(0,0,w,h);
    drawBackgroundGlow();

    const elapsed = now - t0;

    // Timings
    const FORM_MS = 1400;
    const HOLD_MS = 550;
    const BURST_MS = 1500;

    if (phase === 'form' && elapsed > FORM_MS) {
      phase = 'hold';
      t0 = now;
      // lock to targets
      particles.forEach(p => { p.x = p.tx; p.y = p.ty; p.alpha = 1; });
    } else if (phase === 'hold' && elapsed > HOLD_MS) {
      phase = 'burst';
      t0 = now;
      // give burst velocity outward from center
      const cx = w/2, cy = h/2;
      particles.forEach(p => {
        const dx = p.x - cx;
        const dy = p.y - cy;
        const len = Math.hypot(dx,dy) || 1;
        const speed = 2.2 + Math.random()*3.4;
        p.burstVx = (dx/len)*speed + (Math.random()*1.2-0.6);
        p.burstVy = (dy/len)*speed + (Math.random()*1.2-0.6);
      });
    } else if (phase === 'burst' && elapsed > BURST_MS) {
      phase = 'done';
      animOn = false;
      // show final line
      setTimeout(()=> finalText.classList.add('show'), 180);
      return;
    }

    // Update & draw
    particles.forEach(p => {
      if (phase === 'form') {
        const k = Math.min(1, (now - t0) / FORM_MS);
        // ease-out
        const e = 1 - Math.pow(1-k, 3);

        // move toward target
        p.x += (p.tx - p.x) * (0.10 + 0.22*e);
        p.y += (p.ty - p.y) * (0.10 + 0.22*e);

        p.alpha = Math.min(1, p.alpha + 0.035);
        p.rot += p.spin;
      }

      if (phase === 'hold') {
        p.rot += p.spin * 0.6;
        // tiny shimmer
        p.alpha = 0.85 + 0.15*Math.sin((now*0.01) + p.tx*0.001);
      }

      if (phase === 'burst') {
        const k = Math.min(1, (now - t0) / BURST_MS);
        p.x += p.burstVx * (1 - 0.35*k);
        p.y += p.burstVy * (1 - 0.35*k) + 0.25*k; // slight gravity
        p.rot += p.spin * 1.6;
        p.alpha = Math.max(0, 1 - k);
      }

      if (p.alpha <= 0) return;

      ctx.save();
      ctx.globalAlpha = p.alpha;
      ctx.translate(p.x, p.y);
      ctx.rotate(p.rot);
      ctx.font = `${p.size}px system-ui, "Apple Color Emoji","Segoe UI Emoji"`;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(p.emoji, 0, 0);
      ctx.restore();
    });

    requestAnimationFrame(tick);
  }

  // ========= 3) â€œæœˆå…‰å°å¤œæ›²â€æ°›å›´é’¢ç´ï¼ˆæµè§ˆå™¨åˆæˆï¼‰ =========
  // è¯´æ˜ï¼šæµè§ˆå™¨é™åˆ¶è‡ªåŠ¨æ’­æ”¾ï¼Œå¿…é¡»ç”¨æˆ·ç‚¹å‡»è§¦å‘ï¼Œæ‰€ä»¥æ”¾åœ¨â€œåŸè°…â€æŒ‰é’®é‡Œå¯åŠ¨ã€‚
  let audioCtx = null;
  function midiToHz(m){ return 440 * Math.pow(2, (m-69)/12); }

  function playPianoNote(time, midi, dur, vol){
    const ctxA = audioCtx;
    const o = ctxA.createOscillator();
    const g = ctxA.createGain();
    const f = ctxA.createBiquadFilter();
    f.type = 'lowpass';
    f.frequency.setValueAtTime(2200, time);
    f.Q.setValueAtTime(0.7, time);

    o.type = 'triangle'; // warm-ish
    o.frequency.setValueAtTime(midiToHz(midi), time);

    // Envelope (piano-like)
    g.gain.setValueAtTime(0.0001, time);
    g.gain.exponentialRampToValueAtTime(vol, time + 0.015);
    g.gain.exponentialRampToValueAtTime(0.0001, time + dur);

    // Slight detune for richness
    o.detune.setValueAtTime((Math.random()*6-3), time);

    o.connect(f);
    f.connect(g);
    g.connect(ctxA.destination);

    o.start(time);
    o.stop(time + dur + 0.05);
  }

  function playMoonlightVibe(){
    if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const t = audioCtx.currentTime + 0.05;

    // A gentle â€œnight serenadeâ€ motif (public-domain vibe, not using external files)
    // Left hand broken chords + right hand melody-ish
    const tempo = 92; // bpm
    const beat = 60/tempo;

    const left = [
      [57, 64, 69], // A minor-ish
      [55, 62, 67], // G
      [52, 59, 64], // E
      [53, 60, 65], // F
    ];

    const melody = [69, 71, 72, 71, 69, 67, 69, 64, 66, 67, 69, 71, 69, 67, 66, 64];

    let time = t;

    // 8 bars-ish
    for(let bar=0; bar<4; bar++){
      const chord = left[bar % left.length];

      // left hand arpeggio (8th notes)
      for(let i=0;i<8;i++){
        const note = chord[i % 3] - 12; // lower octave
        playPianoNote(time + i*(beat/2), note, beat*0.45, 0.18);
      }

      // right hand: 4 melody notes per bar (quarter notes)
      for(let j=0;j<4;j++){
        const m = melody[bar*4 + j] || 69;
        playPianoNote(time + j*beat, m, beat*0.9, 0.12);
      }

      time += beat*4;
    }
  }

  // ========= 4) click yes =========
  yesBtn.addEventListener('click', async ()=>{
    // disable buttons after yes
    yesBtn.disabled = true;
    noBtn.disabled = true;
    yesBtn.style.filter = 'brightness(1.05)';
    noBtn.style.opacity = '0.35';

    // start music (user gesture)
    try{
      if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      if (audioCtx.state === 'suspended') await audioCtx.resume();
      playMoonlightVibe();
    }catch(e){}

    // big heart firework
    finalText.classList.remove('show');
    spawnHeartFirework();
  });
</script>
</body>
</html>
