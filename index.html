<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ç»™å¶å­çš„é“æ­‰</title>
  <style>
    :root{
      --bg1:#070816;
      --bg2:#1a0a2c;
      --card:#ffffff14;
      --card2:#ffffff1c;
      --txt:#fff;
      --muted:#ffffffcc;
      --yes:#4ade80;
      --no:#f87171;
      --btnTxt:#0b1020;
      --pink:#ff4fa3;
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; font-family: system-ui, -apple-system, "Segoe UI", Roboto, "PingFang SC","Noto Sans SC", Arial, sans-serif; }
    body{
      overflow:hidden;
      background:
        radial-gradient(1200px 700px at 20% 20%, #3b82f650, transparent 60%),
        radial-gradient(900px 600px at 80% 30%, #a855f750, transparent 55%),
        radial-gradient(900px 700px at 50% 90%, #22c55e30, transparent 55%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      color:var(--txt);
    }

    /* FX layer */
    canvas#fx{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:999;
    }

    .wrap{
      height:100%;
      display:grid;
      place-items:center;
      padding:24px;
    }
    .card{
      width:min(900px, 96vw);
      border-radius:28px;
      background: linear-gradient(180deg, var(--card), var(--card2));
      backdrop-filter: blur(10px);
      border:1px solid #ffffff22;
      box-shadow: 0 20px 90px #00000066;
      padding:34px 28px 24px;
      position:relative;
    }

    h1{
      margin:0 0 10px;
      font-size: clamp(30px, 4.2vw, 46px);
      letter-spacing: .4px;
      line-height: 1.15;
    }
    p{
      margin: 12px 0;
      color: var(--muted);
      line-height:1.7;
      font-size: clamp(16px, 2vw, 20px);
    }
    .note{
      margin-top:16px;
      padding:16px 18px;
      border-radius:18px;
      background:#ffffff12;
      border:1px dashed #ffffff33;
      color:#f1f2ff;
      font-size: clamp(15px, 1.7vw, 18px);
      line-height: 1.7;
    }

    .stage{
      position:relative;
      margin-top:22px;
      height:260px;
      border-radius:22px;
      background: #00000022;
      border:1px solid #ffffff14;
      overflow:hidden;
    }

    .btn{
      border:0;
      padding:16px 28px;
      font-weight:900;
      border-radius:999px;
      cursor:pointer;
      user-select:none;
      box-shadow: 0 12px 34px #00000055;
      transition: transform .12s ease, filter .12s ease, box-shadow .12s ease;
      position:absolute;
      min-width:150px;
      font-size: 20px;
      letter-spacing: .5px;
    }
    .btn:hover{ transform: translateY(-2px) scale(1.02); filter:brightness(1.03); }
    .btn:active{ transform: translateY(0) scale(0.99); box-shadow: 0 8px 22px #00000044; }

    #yesBtn{ background: var(--yes); color: var(--btnTxt); left: 30%; top: 58%; }
    #noBtn{ background: var(--no); color: #ffffff; left: 58%; top: 58%; }

    .toast{
      position:fixed;
      left:50%;
      top:18px;
      transform: translateX(-50%);
      background:#00000066;
      border:1px solid #ffffff22;
      backdrop-filter: blur(8px);
      color:#ffffffef;
      padding:12px 16px;
      border-radius:999px;
      font-size:14px;
      z-index:1001;
      opacity:0;
      transition: opacity .25s ease, transform .25s ease;
      pointer-events:none;
    }
    .toast.show{
      opacity:1;
      transform: translateX(-50%) translateY(4px);
    }

    /* Autoplay helper bar (only when blocked) */
    .soundBar{
      position:fixed;
      left:50%;
      bottom:18px;
      transform: translateX(-50%);
      z-index:1003;
      background: rgba(0,0,0,.55);
      border: 1px solid rgba(255,255,255,.22);
      backdrop-filter: blur(10px);
      color:#fff;
      padding: 10px 14px;
      border-radius: 999px;
      font-size: 14px;
      display:none;
      cursor:pointer;
      user-select:none;
      box-shadow: 0 18px 60px rgba(0,0,0,.4);
    }
    .soundBar.show{ display:flex; gap:10px; align-items:center; }
    .soundDot{
      width:10px; height:10px; border-radius:50%;
      background: var(--pink);
      box-shadow: 0 0 0 7px rgba(255,79,163,.18);
      flex: 0 0 auto;
    }

    /* Pink heart coupon (SVG precise heart) */
    .couponWrap{
      position:fixed;
      left:50%;
      top:50%;
      transform: translate(-50%, -50%) scale(0.98);
      z-index:1002;
      opacity:0;
      transition: opacity .6s ease, transform .6s ease;
      pointer-events:none;
      text-align:center;
      padding: 0 16px;
    }
    .couponWrap.show{
      opacity:1;
      transform: translate(-50%, -50%) scale(1);
    }
    .coupon{
      position:relative;
      width: min(720px, 92vw);
      aspect-ratio: 1.45 / 1;
      display:grid;
      place-items:center;
      filter: drop-shadow(0 26px 70px rgba(0,0,0,.45));
    }
    .coupon svg{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
    }
    .couponText{
      position:relative;
      z-index:1;
      padding: 0 10%;
      font-weight: 1000;
      color:#fff;
      text-shadow: 0 12px 30px rgba(0,0,0,.45);
      font-size: clamp(18px, 3vw, 34px);
      line-height: 1.25;
    }

    audio{ display:none; }
  </style>
</head>
<body>
  <canvas id="fx"></canvas>
  <div class="toast" id="toast">å®ƒè·‘äº†â€¦å› ä¸ºå®ƒå¿ƒè™š ğŸ˜…</div>

  <!-- Put bgm.mp3 in the repository root -->
  <audio id="bgm" src="./bgm.mp3" preload="auto" loop playsinline></audio>

  <div class="soundBar" id="soundBar" title="ç‚¹ä¸€ä¸‹å¼€å¯éŸ³ä¹">
    <span class="soundDot"></span>
    <span>ç‚¹ä¸€ä¸‹å¼€å¯éŸ³ä¹ ğŸ¹</span>
  </div>

  <div class="couponWrap" id="couponWrap">
    <div class="coupon">
      <!-- A clean symmetric heart -->
      <svg viewBox="0 0 512 448" aria-hidden="true">
        <path
          d="M256 432s-28-20.9-56-42.6C134.1 343.2 64 285.6 32.6 227.9 1.3 170.4 6.7 96.7 61.7 55.9 105.6 23.7 168.2 31.1 208 72c18.5 19 30.8 43.9 48 69.8 17.2-25.9 29.5-50.8 48-69.8 39.8-40.9 102.4-48.3 146.3-16.1 55 40.8 60.4 114.5 29.1 172-31.4 57.7-101.5 115.3-167.4 161.5C284 411.1 256 432 256 432z"
          fill="var(--pink)"/>
      </svg>
      <div class="couponText">è¿™æ˜¯ä¸€å¼ æ— æ¡ä»¶å¦¥ååˆ¸ï¼Œè¯·æˆªå›¾ä¿å­˜ï¼Œæ—¥åä½¿ç”¨ï¼Œä»…é™ä¸€æ¬¡ã€‚</div>
    </div>
  </div>

  <div class="wrap">
    <div class="card">
      <h1>å¶å­ï¼Œæˆ‘æƒ³è®¤çœŸè·Ÿä½ è¯´å£°å¯¹ä¸èµ·ã€‚</h1>
      <p>
        æˆ‘çŸ¥é“ä½ ç°åœ¨å¾ˆå¤±æœ›ï¼Œä¹Ÿéœ€è¦æ—¶é—´æ¶ˆåŒ–ã€‚<br>
        æˆ‘ä¼šç”¨è¡ŒåŠ¨æŠŠä½ è¦çš„â€œå¯é â€å’Œâ€œå¦è¯šâ€æ‹¼å¥½ã€‚
      </p>

      <div class="note">
        ä½ å¯ä»¥æ…¢æ…¢æ¶ˆåŒ–ã€‚æˆ‘ä¼šåœ¨ï¼Œä¸é€ƒé¿ï¼Œä¹Ÿä¸æ•·è¡ã€‚<br>
        åªè¦ä½ æ„¿æ„ç»™æˆ‘ä¸€æ¬¡æœºä¼šï¼Œæˆ‘ä¼šæŠŠâ€œä½ æœ€é‡è¦â€åšæˆé•¿æœŸæœ‰æ•ˆã€‚
      </div>

      <div class="stage" id="stage">
        <button class="btn" id="yesBtn">åŸè°…</button>
        <button class="btn" id="noBtn">ä¸åŸè°…</button>
      </div>
    </div>
  </div>

<script>
  // ========= A) Background music autoplay (best-effort + fallback) =========
  const bgm = document.getElementById('bgm');
  const soundBar = document.getElementById('soundBar');

  async function tryAutoplay(){
    try{
      // some browsers require explicit volume set
      bgm.volume = 0.9;
      await bgm.play();
      soundBar.classList.remove('show');
    }catch(e){
      // Autoplay blocked: show helper bar, start on any user interaction
      soundBar.classList.add('show');
    }
  }

  // Try immediately + after first render
  window.addEventListener('load', tryAutoplay);
  // Also try on visibility changes (sometimes helps)
  document.addEventListener('visibilitychange', ()=>{
    if (!document.hidden) tryAutoplay();
  });

  // One-tap to enable sound
  async function enableSoundOnce(){
    try{
      await bgm.play();
      soundBar.classList.remove('show');
      window.removeEventListener('pointerdown', enableSoundOnce);
      window.removeEventListener('touchstart', enableSoundOnce);
      window.removeEventListener('keydown', enableSoundOnce);
    }catch(e){}
  }
  soundBar.addEventListener('click', enableSoundOnce);
  window.addEventListener('pointerdown', enableSoundOnce, { once:false });
  window.addEventListener('touchstart', enableSoundOnce, { once:false, passive:true });
  window.addEventListener('keydown', enableSoundOnce, { once:false });

  // ========= B) â€œä¸åŸè°…â€æŒ‰é’®èº²é¿ =========
  const stage = document.getElementById('stage');
  const noBtn = document.getElementById('noBtn');
  const yesBtn = document.getElementById('yesBtn');
  const toast = document.getElementById('toast');
  const couponWrap = document.getElementById('couponWrap');

  let lastMoveAt = 0;
  function showToast(){
    toast.classList.add('show');
    clearTimeout(showToast._t);
    showToast._t = setTimeout(()=> toast.classList.remove('show'), 850);
  }
  function clamp(n,min,max){ return Math.max(min, Math.min(max,n)); }

  function moveNoButton(){
    const now = performance.now();
    if (now - lastMoveAt < 120) return;
    lastMoveAt = now;

    const pad = 18;
    const st = stage.getBoundingClientRect();
    const nb = noBtn.getBoundingClientRect();
    const maxLeft = st.width - nb.width - pad;
    const maxTop  = st.height - nb.height - pad;

    const left = clamp(Math.random()*maxLeft, pad, maxLeft);
    const top  = clamp(Math.random()*maxTop,  pad, maxTop);

    noBtn.style.left = left + 'px';
    noBtn.style.top  = top + 'px';

    noBtn.animate([
      { transform: 'translateY(0) rotate(0deg) scale(1)' },
      { transform: 'translateY(-3px) rotate(-4deg) scale(1.03)' },
      { transform: 'translateY(0) rotate(3deg) scale(1)' }
    ], { duration: 220, easing: 'ease-out' });

    showToast();
  }

  ['mouseenter','mousemove','pointermove','touchstart'].forEach(evt=>{
    noBtn.addEventListener(evt, (e)=>{
      moveNoButton();
      e.preventDefault?.();
    }, { passive:false });
  });

  stage.addEventListener('mousemove', (e)=>{
    const st = stage.getBoundingClientRect();
    const x = e.clientX - st.left;
    const y = e.clientY - st.top;

    const nb = noBtn.getBoundingClientRect();
    const nx = (nb.left - st.left) + nb.width/2;
    const ny = (nb.top - st.top) + nb.height/2;

    const dist = Math.hypot(x-nx, y-ny);
    if (dist < 95) moveNoButton();
  });

  // ========= C) Continuous hearts burst from center =========
  const canvas = document.getElementById('fx');
  const ctx = canvas.getContext('2d');

  function resize(){
    const dpr = window.devicePixelRatio || 1;
    canvas.width = Math.floor(window.innerWidth * dpr);
    canvas.height = Math.floor(window.innerHeight * dpr);
    canvas.style.width = window.innerWidth + 'px';
    canvas.style.height = window.innerHeight + 'px';
    ctx.setTransform(dpr,0,0,dpr,0,0);
  }
  window.addEventListener('resize', resize);
  resize();

  let hearts = [];
  let running = false;
  let lastSpawn = 0;

  function rand(min,max){ return min + Math.random()*(max-min); }

  function spawnHeartsFromCenter(count){
    const cx = window.innerWidth/2;
    const cy = window.innerHeight/2;

    for(let i=0;i<count;i++){
      const a = Math.random()*Math.PI*2;
      const speed = rand(1.8, 5.2);
      hearts.push({
        x: cx + rand(-6,6),
        y: cy + rand(-6,6),
        vx: Math.cos(a)*speed,
        vy: Math.sin(a)*speed,
        rot: rand(0, Math.PI*2),
        vr: rand(-0.06, 0.06),
        life: 0,
        ttl: rand(1400, 2400),
        size: rand(14, 28),
        emoji: Math.random() < 0.6 ? 'ğŸ’—' : (Math.random() < 0.5 ? 'ğŸ’–' : 'ğŸ’')
      });
    }
  }

  function tick(now){
    if (!running) return;

    const w = window.innerWidth, h = window.innerHeight;
    ctx.clearRect(0,0,w,h);

    // spawn continuously
    if (now - lastSpawn > 70){
      lastSpawn = now;
      spawnHeartsFromCenter(4);
    }

    hearts = hearts.filter(p => p.life < p.ttl);

    for(const p of hearts){
      p.life += 16;
      const k = p.life / p.ttl;

      p.x += p.vx;
      p.y += p.vy;
      p.vy += 0.004 * p.life; // gentle gravity
      p.rot += p.vr;

      const alpha = k < 0.75 ? 1 : Math.max(0, 1 - (k-0.75)/0.25);

      ctx.save();
      ctx.globalAlpha = alpha;
      ctx.translate(p.x, p.y);
      ctx.rotate(p.rot);
      ctx.font = `${p.size}px system-ui, "Apple Color Emoji","Segoe UI Emoji"`;
      ctx.textAlign = 'center';
      ctx.textBaseline = 'middle';
      ctx.fillText(p.emoji, 0, 0);
      ctx.restore();
    }

    requestAnimationFrame(tick);
  }

  // ========= D) Click yes: show coupon + start hearts =========
  let started = false;
  yesBtn.addEventListener('click', ()=>{
    if (started) return;
    started = true;

    yesBtn.disabled = true;
    noBtn.disabled = true;
    noBtn.style.opacity = '0.35';

    couponWrap.classList.add('show');

    running = true;
    lastSpawn = performance.now();
    requestAnimationFrame(tick);
  });
</script>
</body>
</html>
